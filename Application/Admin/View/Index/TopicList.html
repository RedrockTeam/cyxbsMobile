<div class="portlet light portlet-fit portlet-datatable bordered">
    <div class="portlet-title">
        <div class="caption">
            <i class="fa fa-book font-green"></i>
            <span class="caption-subject font-green sbold uppercase">话题列表</span>
        </div>
        <div class="actions">
            <div class="btn-group">
                <a class="btn btn-circle blue-hoki" href="javascript:;" data-target="#addTopic" data-toggle="modal">增加话题 <i class="fa fa-plus"></i> </a>
            </div>
        </div>
    </div>
    <div class="portlet-body">
        <div class="table-toolbar">
            <div class="row" target-table="topicListTable" >
                <div class="col-md-6" >


                </div>
                <div class="col-md-6">
                    <div class="btn-group pull-right btn-group-circle" >
                        <button class="btn green" href="javascript:;" data-toggle="dropdown">
                            <i class="fa fa-book"></i> 话题
                            <i class="fa fa-angle-down"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li> <a href="javascript:;" operate="recover"><i class="fa fa-history"></i> 恢 复 </a> </li>
                            <li> <a href="javascript:;" operate="delete"><i class="fa fa-trash-o"></i> 删 除 </a> </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <table class="table table-striped table-bordered table-hover table-checkable order-column" id="topicListTable">
            <thead>
            <tr>
                <th class="table-checkbox"> <label class="mt-checkbox mt-checkbox-single mt-checkbox-outline"> <input type="checkbox" class="group-checkable" data-set="#topicListTable .checkboxes" /> <span></span> </label> </th>
                <th data-data="id" data-searchable="false" data-visible="false">Id</th>
                <th data-data="author" data-searchable="true">作者</th>
                <th data-data="keyword" data-searchable="true">关键词</th>
                <th data-data="content" data-searchable="false">内容</th>
                <th data-data="like_num" data-searchable="false">点赞数</th>
                <th data-data="join_num" data-searchable="false">参与人数</th>
                <th data-data="article_num" data-searchable="false">文章数</th>
                <th data-data="created_time" data-searchable="false">话题创建时间</th>
                <th data-data="state" data-searchable="false" data-orderable="false">状态</th>
                <th data-data="official" data-searchable="false" data-orderable="false">代表</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>

<div id="addTopic" class="modal fade" data-backdrop="static" data-keyboard="false" role="dialog">
    <div class="portlet-body form" id="article_wizard">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="false"> × </button>
            <h4 class="modal-title"><i class="fa fa-plus"></i> 添加话题 </h4>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <div class="input-icon">
                    <i class="fa fa-bullhorn font-green"></i>
                    <input type="text" class="form-control" placeholder="关键词" name="keyword">
                </div>
            </div>
            <div class="form-group">
                <div class="input-icon">
                    <i class="fa fa-comment-o font-green"></i>
                    <input type="text" class="form-control" placeholder="想写点啥。。" name="content">
                </div>
            </div>
            <div class="form-group">
                <input type="checkbox" class="make-switch"  name="is_official" data-on-text="官方" data-off-text="个人" data-on-color="warning" data-off-color="danger">
            </div>
            <div class="form-group">
                <form>
                    <div class="form-group">
                        <div class="row fileupload-buttonbar" style="margin-left: 0px;">
                            <span class="btn green fileinput-button btn-file">
                                <i class="fa fa-plus"></i>
                            <span> 添加 </span>
                           <input type="file" name="fold[]" multiple=""> </span>
                            <button type="submit" class="btn blue start">
                                <i class="fa fa-upload"></i>
                                <span> 开始上传 </span>
                            </button>
                            <button type="reset" class="btn warning cancel">
                                <i class="fa fa-ban-circle"></i>
                                <span> 停止上传 </span>
                            </button>
                            <button type="button" class="btn red delete">
                                <i class="fa fa-trash"></i>
                                <span> 删除 </span>
                            </button>
                            <!--<input type="checkbox" class="toggle">-->
                            <span class="fileupload-process"> </span>
                        </div>
                        <div class="col-lg-5 fileupload-progress fade">
                            <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                                <div class="progress-bar progress-bar-success" style="width:0%;"> </div>
                            </div>
                            <div class="progress-extended"> &nbsp; </div>
                        </div></div>
                    <table role="presentation" class="table table-striped"><tbody class="files"></tbody></table>
                </form>
                <script id="template-upload" type="text/x-tmpl">
              {% for (var i=0, file; file=o.files[i]; i++) { %}
                  <tr class="template-upload fade">
                      <td>
                          <span class="preview"></span>
                      </td>
                      <td>
                          <p class="name">{%=file.name.substr(0,8)%}</p>
                          <strong class="error text-danger"></strong>
                      </td>
                      <td>
                          <p class="size">加载中</p>
                          <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><div class="progress-bar progress-bar-success" style="width:0%;"></div></div>
                      </td>
                      <td>
                          {% if (!i && !o.options.autoUpload) { %}
                              <button class="btn btn-primary start" disabled>
                                  <i class="glyphicon glyphicon-upload"></i>
                                  <span>开始</span>
                              </button>
                          {% } %}
                          {% if (!i) { %}
                              <button class="btn btn-warning cancel">
                                  <i class="glyphicon glyphicon-ban-circle"></i>
                                  <span>取消</span>
                              </button>
                          {% } %}
                      </td>
                  </tr>
              {% } %}
              </script>
                <!-- The template to display files available for download -->
                <script id="template-download" type="text/x-tmpl">
              {% for (var i=0, file; file=o.files[i]; i++) { %}
                  <tr class="template-download fade" style="width:490px;" >
                      <td>
                          <span class="preview">
                              {% if (file.thumbnailUrl) { %}
                                  <a href="{%=file.url%}" title="{%=file.name%}" download="{%=file.name%}" data-gallery><img src="{%=file.thumbnailUrl%}"></a>
                              {% } %}
                          </span>
                      </td>
                      <td>
                          <p class="name">
                              {% if (file.url) { %}
                                  <a href="{%=file.url%}" title="{%=file.name%}" download="{%=file.name%}" {%=file.thumbnailUrl?\'data-gallery\':\'\'%}>{%=file.name%}</a>
                              {% } else { %}
                                  <span>{%=file.name.substr(0,8)%}</span>
                              {% } %}
                          </p>
                          {% if (file.error) { %}
                              <div><span class="label label-danger">Error</span> {%=file.error%}</div>
                          {% } %}
                      </td>
                      <td>
                          <span class="size">{%=o.formatFileSize(file.size)%}</span>
                      </td>
                      <td>
                          {% if (file.deleteUrl) { %}
                              <button class="btn btn-danger delete" data-type="{%=file.deleteType%}" data-url="{%=file.deleteUrl%}"{% if (file.deleteWithCredentials) { %} data-xhr-fields=\'{"withCredentials":true}\'{% } %}>
                                  <i class="glyphicon glyphicon-trash"></i>
                                  <span>删除</span>
                              </button>
                          {% } else { %}
                              <button class="btn btn-warning cancel">
                                  <i class="glyphicon glyphicon-ban-circle"></i>
                                  <span>取消</span>
                              </button>
                          {% } %}
                      </td>
                  </tr>
              {% } %}
        </script>
            </div>

        </div>
        <div class="modal-footer">
            <button type="button" data-dismiss="modal" class="btn dark btn-outline">关闭</button>
            <button type="button" class="btn green" action="submit" >添加</button>
        </div>
    </div>
</div>


<script type="text/javascript">
    $('.make-switch').bootstrapSwitch();
    var ComponentsBootstrapSelect=function(){var n=function(){$(".bs-select").selectpicker({iconBase:"fa",tickIcon:"fa-check"})};return{init:function(){n()}}}();App.isAngularJsApp()===!1&&jQuery(document).ready(function(){ComponentsBootstrapSelect.init()});
    jQuery(document).ready(function(){
        initTable('topicListTable', '{:U("Data/topicList")}', '{:U("Topic/operate")}', ['id']);
        UIExtendedModals.init();
    });
    var topiceModal = $('#addTopic');
    var FormAttrbution = {
        id: 'upload',
        action: getUrl()+'/Home/Photo/multipleUploadArticle',
        method: 'post',
    };
    var form = topiceModal.find("form");
    form.attr(FormAttrbution);
    FormFileUpload.init('#'+ form.attr('id'));
    topiceModal.find('[action="submit"]').on('click',function () {
        var keyword = $('[name="keyword"]').val();
        var content = $('[name="content"]').val();
        if(keyword==='' || content==='') {
            alert("不能为空");
            return;
        }
        var photo_src = "";
        var thumbnail_src = "";
        var photo = $('.files .template-download');
        $.each(photo, function(key, value){
            var p_src = $(value).find('.preview a').attr('href');
            photo_src += p_src.substr(p_src.lastIndexOf('/')+1)+',';
            var thumb_src = $(value).find('.preview img').attr('src');
            thumbnail_src += thumb_src.substr(thumb_src.lastIndexOf('/')+1)+',';
        });
        photo_src = photo_src.substring(0, photo_src.length-1);
        thumbnail_src = thumbnail_src.substring(0, thumbnail_src.length-1);
        $.ajax({
            url: getUrl()+"/Admin/Topic/addTopic",
            data:{
                'keyword' : keyword,
                'content' : content,
                'official' : $('[name="is_official"]').bootstrapSwitch('state'),
                'thumbnail_src': thumbnail_src,
                'photo_src': photo_src,
            },
            dataTypeString:'text',
            type: 'post',
            success:function (data) {
                data = connection.decode(data);
                if (data.status === 200) {
                    alert("添加成功");
                } else {
                    alert(data.info);
                }
                topiceModal.modal('hide');
            }
        });
    });
</script> 
 